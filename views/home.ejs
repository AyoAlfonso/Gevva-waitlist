<!doctype html>
<html lang="en" dir="ltr">
   <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
      <meta http-equiv="X-UA-Compatible" content="ie=edge">
      <meta http-equiv="Content-Language" content="en" />
      <meta name="msapplication-TileColor" content="#2d89ef">
      <meta name="theme-color" content="#4188c9">
      <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
      <meta name="apple-mobile-web-app-capable" content="yes">
      <meta name="mobile-web-app-capable" content="yes">
      <meta name="HandheldFriendly" content="True">
      <meta name="MobileOptimized" content="320">
      <link rel="icon" href="./favicon.ico" type="image/x-icon"/>
      <link rel="shortcut icon" type="image/x-icon" href="./favicon.ico" />
      <!-- Generated: 2018-04-06 16:27:42 +0200 -->
      <title>Admin Home </title>
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
      <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,300i,400,400i,500,500i,600,600i,700,700i&amp;subset=latin-ext">
      <!-- Dashboard Core -->
      <link href="https://s3.us-east-2.amazonaws.com/nannyfix-campaign/nannyfix-dash/css/dashboard.css" rel="stylesheet" />
      <script src="https://s3.us-east-2.amazonaws.com/nannyfix-campaign/nannyfix-dash/js/dashboard.js"></script>
      <!-- Input Mask Plugin -->
      <script src="https://s3.us-east-2.amazonaws.com/nannyfix-campaign/nannyfix-dash/plugins/input-mask/plugin.js"></script>
      <script src="https://s3.us-east-2.amazonaws.com/nannyfix-campaign/nannyfix-dash/assets/js/require.min.js"></script>
      <script src="https://rawgit.com/jjppof/breedjs/master/min/breedjs.min.js "></script>
   </head>
   <body class="">
      <div class="page">
         <div class="page-main">
            <div class="header py-4">
               <div class="container">
                  <div class="d-flex">
                     <a class="header-brand" href="/admin">
                     <img src="https://gevva.co/images/gevva-new-logo.svg" style="border-radius: 5px; background-color: #000; padding: 5px; " class="header-brand-img" alt="tabler logo">
                     </a>
                     <div class="d-flex order-lg-2 ml-auto">
                        <div class="dropdown">
                           <a href="/admin/logout" class="nav-link pr-0 leading-none" data-toggle="dropdown">
                           <span class="avatar" style="background-image: url(https://www.nannyfix.com/img/awesome.png)"></span>
                           <span class="ml-2 d-none d-lg-block">
                           <span class="text-default">Admin</span>
                           <small class="text-muted d-block mt-1">Logout</small>
                           </span>
                           </a>
                           <div class="dropdown-menu dropdown-menu-right dropdown-menu-arrow">
                              <a class="dropdown-item" href="#">
                              <i class="dropdown-icon fe fe-user"></i> Profile
                              </a>
                              <a class="dropdown-item" href="#">
                              <i class="dropdown-icon fe fe-settings"></i> Settings
                              </a>
                              <a class="dropdown-item$" href="#">
                              <span class="float-right"><span class="badge badge-primary">6</span></span>
                              <i class="dropdown-icon fe fe-mail"></i> Inbox
                              </a>
                              <a class="dropdown-item" href="#">
                              <i class="dropdown-icon fe fe-send"></i> Message
                              </a>
                              <div class="dropdown-divider"></div>
                              <a class="dropdown-item" href="#">
                              <i class="dropdown-icon fe fe-help-circle"></i> Need help?
                              </a>
                              <a class="dropdown-item" href="#">
                              <i class="dropdown-icon fe fe-log-out"></i> Sign out
                              </a>
                           </div>
                        </div>
                     </div>
                     <a href="#" class="header-toggler d-lg-none ml-3 ml-lg-0" data-toggle="collapse" data-target="#headerMenuCollapse">
                     <span class="header-toggler-icon"></span>
                     </a>
                  </div>
               </div>
            </div>
            <div class="header collapse d-lg-flex p-0" id="headerMenuCollapse">
               <div class="container">
                  <div class="row align-items-center">
                     <div class="col-lg order-lg-first">
                        <ul class="nav nav-tabs border-0 flex-column flex-lg-row">
                           <li class="nav-item">
                              <a href="/admin" class="nav-link active"><i class="status-icon bg-success"></i>Refresh page</a>
                           </li>
                           <li>
                              <!-- more things can be added here -->
                           </li>
                        </ul>
                     </div>
                  </div>
               </div>
            </div>
            <div class="my-3 my-md-5">
               <div class="container">
                  <div class="page-header">
                     <h1 class="page-title">
                        Dashboard
                     </h1>
                  </div>
                  <div class="row row-cards">
                     <div class="col-6 col-sm-4 col-lg-2"style="margin: 0px 0px 10px -10px;">
                        <div class="card">
                           <div class="card-body p-3 text-center">
                              <div class="text-right text-green">
                                 6%
                              </div>
                              <div class="h1 m-0"> <%=countLatestUsers%> </div>
                              <div class="text-muted mb-4">New Members</div>
                           </div>
                        </div>
                     </div>
                     <div class="col-6 col-sm-4 col-lg-2" style="margin: 0px 0px 10px -10px;">
                        <div class="card">
                           <div class="card-body p-3 text-center">
                              <div class="text-right text-red">
                                 -3%
                              </div>
                              <div class="h1 m-0"> <%= todayUsers %> </div>
                              <div class="text-muted mb-4">Signed Up Today</div>
                           </div>
                        </div>
                     </div>
                     <div class="col-md-6">
                        <div class="alert alert-primary">The <b> "New Signups"</b>above represent members that have signed up in the last 72 hrs. <b> "Most Active"</b> below represents the members with at least 5 referral counts </div>
                     </div>
                     <div class="row">
                        <div class="col-sm-6">
                           <div class="card">
                              <div class="card-body text-center">
                                 <div class="h5">Invites</div>
                                 <div class="display-4 font-weight-bold mb-4"><%= invitationSent %></div>
                              </div>
                           </div>
                        </div>
                        <div class="col-sm-6">
                           <div class="card">
                              <div class="card-body text-center">
                                 <div class="h5"> Most Active</div>
                                 <div class="display-4 font-weight-bold mb-4"> <%=topUsers%> </div>
                              </div>
                           </div>
                        </div>
                        <div class="col-sm-6 col-lg-6">
                           <div class="card p-3">
                              <div class="d-flex align-items-center">
                                 <span class="stamp stamp-md bg-red mr-3">
                                 <i class="fe fe-users"></i>
                                 </span>
                                 <div>
                                    <h4 class="m-0"><a href="javascript:void(0)"> <%= count %> <small>Members</small></a></h4>
                                    <small class="text-muted"> <%= todayUsers %> registered today</small>
                                 </div>
                              </div>
                           </div>
                        </div>
                        <div class="col-sm-6 col-lg-6">
                           <div class="card p-3">
                              <div class="d-flex align-items-center">
                                 <span class="stamp stamp-md bg-yellow mr-3">
                                 <i class="fe fe-message-square"></i>
                                 </span>
                                 <div>
                                    <h4 class="m-0"><a href="javascript:void(0)"> <%= invitationUsed %><small> Invites Used</small></a></h4>
                                    <small class="text-muted"> <%= invitationSent-invitationUsed %> Delaying</small>
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="row mt-5">
                     <div class="col-sm-6 col-lg-6" style="">
                        <div class="form-group">
                           <div class="col-auto row">
                              <label class="form-label col-md-12">Pick your range</label>
                              <div class="col-md-4 col-sm-6 col-lg-6">
                                 <label for="rangeStart" class="form-label">Start:</label>
                                 <input type="number" class="form-control w-8" id="rangeStart" placeholder="0"> 
                              </div>
                              <div class="col-md-4 col-sm-6 col-lg-6">
                                 <label for="rangeEnd" class="form-label">End</label>
                                 <input type="number" class="form-control w-8" id="rangeEnd" placeholder="100">  
                              </div>
                              <input type="submit" value="Multi-Invite" onclick="return onMultiInvite()" id="massinvite" class="btn btn-primary mt-4 mb-4 ml-3">
                              <!-- <input type="submit" value="Inivite Univited" onclick="return onMultiInvite(this.id)" id="mass-invite-new-email" class="btn btn-primary mt-4 mb-4 ml-3"> -->
                              <div>
                                 <br>
                              </div>
                              <div class="input-group">
                                 <select class="custom-select" id="multinviteOptions">
                                    <option selected="">Choose Categories...</option>
                                    <option value="opens">Opened Invites</option>
                                    <option value="unopens">Unopened Invites</option>
                                 </select>
                                 <div class="input-group-append">
                                    <input type="submit" class="btn btn-primary" value="Reinvite" onclick="return onMultiReInvite()" id="MultinviteOpen">
                                 </div>
                              </div>
                           </div>
                        </div>
                     </div>
                  </div>
                  <div class="col-30">
                     <div class="card">
                        <div class="card-header">
                           <h3 class="card-title">Nannies</h3>
                        </div>
                        <div class="table-responsive">
                           <table class="table card-table table-vcenter text-nowrap" id= "nannytable">
                              <thead>
                                 <tr>
                                    <th class="w-1">Rank</th>
                                    <th>Name</th>
                                    <th>Email</th>
                                    <th>Ref Count</th>
                                    <th>Joined</th>
                                    <th>Invited</th>
                                    <th>Acc Activity</th>
                                    <th>Refcode</th>
                                 </tr>
                              </thead>
                              <tbody>
                                 <% for(var i=0; i<users.length; i++) { %>
                                 <tr>
                                    <td><span class="text-muted"> <%=users[i].position%> </span></td>
                                    <td>
                                       <%=users[i].name %>
                                    </td>
                                    <td>
                                       <div onclick="userPopFunc(this.id)"  class="btn btn-secondary btn-sm" <%{%> id="<%=users[i].referred_by%>"<%} %> >
                                          <%=users[i].email %>
                                       </div>
                                    </td>
                                    <td>
                                       <%=users[i].referral_count%>
                                    </td>
                                    <td>
                                       <%=users[i].created_at%>
                                    </td>
                                    <td>
                                       <%=users[i].invite%>
                                    </td>
                                    <td>
                                       <span <%{%>class="<%=users[i].account_activity_color%>"<%}%>/> </span>  <%=users[i].account_activity%>
                                    </td>
                                    <td>
                                       <div class="btn btn-secondary btn-sm" >
                                          <%=users[i].referral_code%>
                                       </div>
                                       <button class="btn btn-secondary btn-sm"  onclick="onInvite(this.id)" <%{%> id="<%=users[i].referral_code%>"<%} %>/>  Invite</button>
                                       <button class="btn btn-secondary btn-sm"  onclick="onResendInvite(this.id)"  <%{%> id="<%=users[i].referral_code%>"<%} %>/>  Reinvite</button>
                                    </td>
                                    <%}%>
                                 </tr>
                                 <br>
                              </tbody>
                           </table>
                        </div>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
      <div class="footer">
         <div class="container">
            <div class="row">
               <div class="col-lg-8">
                  <div class="row">
                     <div class="col-6 col-md-3">
                        <ul class="list-unstyled mb-0">
                           <li><a href="#">. </a></li>
                           <li><a href="#">. </a></li>
                        </ul>
                     </div>
                     <div class="col-6 col-md-3">
                        <ul class="list-unstyled mb-0">
                           <li><a href="#">. </a></li>
                           <li><a href="#">. </a></li>
                        </ul>
                     </div>
                     <div class="col-6 col-md-3">
                        <ul class="list-unstyled mb-0">
                           <li><a href="#">. </a></li>
                           <li><a href="#">. </a></li>
                        </ul>
                     </div>
                     <div class="col-6 col-md-3">
                        <ul class="list-unstyled mb-0">
                           <li><a href="#">. </a></li>
                           <li><a href="#">. </a></li>
                        </ul>
                     </div>
                  </div>
               </div>
               <div class="col-lg-4 mt-4 mt-lg-0">
                  Waitlist Admin Dashboard In Development
               </div>
            </div>
         </div>
      </div>
      </div>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.min.js"> </script>
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/1.1.3/sweetalert.css">
      <script src="https://s3.us-east-2.amazonaws.com/nannyfix-campaign/nannyfix-dash/sort.js"></script>
      <script>
         function userPopFunc(ref) {
            (ref)? swal(`User Info:`, `Referred By: ${ref} ` ) :  swal(`User Info:`, `Referred by no one`)
         
         }
         
         function onMultiReInvite(){
                 let start = Number.parseInt(document.getElementById("rangeStart").value)
                 let end = Number.parseInt(document.getElementById("rangeEnd").value)
                 let tag = document.getElementById("multinviteOptions").value
               
                 if (tag =="Choose Categories..."){
                   swal({
                        title: 'Bad details',
                        text: `"Choose Categries" is not a valid category`,
                        animation: false
                    });
                    return false
         
                 }
               if (Number.isInteger(start) && Number.isInteger(end)) {
                   if (end>start && end>0 && start>0) {
                             $.ajax({
                             type: "POST",
                             url: "/massreinvite",
                             data: {
                                 from: start,
                                 to: end,
                                 tag: tag
                             },
                        success: function(json) {
                           if (json.code==200) {
                               swal({
                                 title: "Awesome...",
                                 text: json.message,
                                 imageUrl: 'https://www.nannyfix.com/img/awesome.png',
                                 imageWidth: 120,
                                 imageHeight: 120,
                                 animation: false
                               });
                               return true;
                            }
                            if (json.code==409) {
                               swal({
                                 title: "Are you sure you know what you are doing...",
                                 text: json.message,
                                 imageUrl: 'https://www.nannyfix.com/img/awesome.png',
                                 imageWidth: 120,
                                 imageHeight: 120,
                                 animation: false
                             });
                               return true;
                            }
                        },
                        error: function(jqXHR, textStatus, err) {
                            if (err) {
                              console.log(err)
                                swal({
                                    title: 'Oh no!',
                                    text: "An error occured on the server",
                                    animation: false
                                });
                                return false
                            } else {
                                swal.stopLoading();
                                swal.close();
                            }
                        }
                    })
                } else {
                    swal({
                        title: 'Bad details',
                        text: 'These details cannot be accepted',
                        animation: false
                    });
                    return false
                }
             } else {
                    swal({
                        title: 'Bad details',
                        text: 'Input a real a number!',
                        animation: false
                    });
                    return false
                }
         
           }
         function onMultiInvite(id){
                 let start = Number.parseInt(document.getElementById("rangeStart").value)
                 let end = Number.parseInt(document.getElementById("rangeEnd").value)
                 let intent = (id=="massinvite")? "/massinvite" : "/mass-invite-new-email";
                 
                if (Number.isInteger(start) && Number.isInteger(end)) {
                   if (end>start && end>0 && start>0) {
                             $.ajax({
                             type: "POST",
                             url: intent,
                             data: {
                                 from: start,
                                 to: end
                             },
                        success: function(json) {
                           if (json.code==200) {
                               swal({
                                 title: "Awesome...",
                                 text: json.message,
                                 imageUrl: 'https://www.nannyfix.com/img/awesome.png',
                                 imageWidth: 120,
                                 imageHeight: 120,
                                 animation: false
                               });
                               return true;
                            }
                            if (json.code==409) {
                               swal({
                                 title: "Are you sure you know what you are doing...",
                                 text: json.message,
                                 imageUrl: 'https://www.nannyfix.com/img/awesome.png',
                                 imageWidth: 120,
                                 imageHeight: 120,
                                 animation: false
                             });
                               return true;
                            }
                        },
                        error: function(jqXHR, textStatus, err) {
                            if (err) {
                              console.log(err)
                                swal({
                                    title: 'Oh no!',
                                    text: "An error occured on the server",
                                    animation: false
                                });
                                return false
                            } else {
                                swal.stopLoading();
                                swal.close();
                            }
                        }
                    })
                } else {
                  console.log("this")
                    swal({
                        title: 'Bad details',
                        text: 'These details cannot be accepted',
                        animation: false
                    });
                    return false
                }
             } else {
                    swal({
                        title: 'Bad details',
                        text: 'Input a real number!',
                        animation: false
                    });
                    return false
                }
         
           }
         
           function onInvite(e) {
             if (!e) return swal({
                 title: "Wrong details",
                 text: "An error occured on the server",
                 animation: !1
             }), !1;
             $.ajax({
                 type: "POST",
                 url: "/invite",
                 data: {
                     refcode: e
                 },
                 success: function(e) {
                     return 200 == e.code ? (swal({
                         title: "Awesome...",
                         text: e.message,
                         imageUrl: "https://www.nannyfix.com/img/awesome.png",
                         imageWidth: 120,
                         imageHeight: 120,
                         animation: !1
                     }), !0) : 409 == e.code ? (swal({
                         title: "Are you sure you know what you are doing...",
                         text: e.message,
                         imageUrl: "https://www.nannyfix.com/img/awesome.png",
                         imageWidth: 120,
                         imageHeight: 120,
                         animation: !1
                     }), !0) : void 0
                 },
                 error: function(e, t, i) {
                     if (i) return console.log(i), swal({
                         title: "Oh no!",
                         text: "An error occured",
                         animation: !1
                     }), !1;
                     swal.stopLoading(), swal.close()
                 }
             })
         }
             function onResendInvite(e) {
             if (!e) return swal({
                 title: "Wrong details",
                 text: "An error occured on the server",
                 animation: !1
             }), !1;
             $.ajax({
                 type: "POST",
                 url: "/reinvite",
                 data: {
                     refcode: e
                 },
                 success: function(e) {
                     return 200 == e.code ? (swal({
                         title: "Awesome...",
                         text: e.message,
                         imageUrl: "https://www.nannyfix.com/img/awesome.png",
                         imageWidth: 120,
                         imageHeight: 120,
                         animation: !1
                     }), !0) : 409 == e.code ? (swal({
                         title: "Are you sure you know what you are doing...",
                         text: e.message,
                         imageUrl: "https://www.nannyfix.com/img/awesome.png",
                         imageWidth: 120,
                         imageHeight: 120,
                         animation: !1
                     }), !0) : void 0
                 },
                 error: function(e, t, i) {
                     if (i) return console.log(i), swal({
                         title: "Oh no!",
                         text: "An error occured",
                         animation: !1
                     }), !1;
                     swal.stopLoading(), swal.close()
                 }
             })
         }
           
      </script>
   </body>
</html>